var flask = {

    content: [],

    dummyContent: [{"type":"tweet","author":"tylermensah","content":"Anyone who takes longs than 3 minutes to reply i instantly think i'm annoying them.."},{"type":"tweet","author":"SexySpittie","content":"http://t.co/DrOZ7c4gym"},{"type":"tweet","author":"SexySpittie","content":"http://t.co/i7QA7sFZZU"},{"type":"tweet","author":"JemmaBaker8","content":"@Cammersss http://t.co/7Drmwc13kp"},{"type":"tweet","author":"SexySpittie","content":"http://t.co/H8CndY6c2v"},{"type":"tweet","author":"SexySpittie","content":"http://t.co/Xcka5OMXCN"},{"type":"tweet","author":"_GisselleRamos","content":"¬øQu√© nos pas√≥? antes nos cont√°bamos de todo y nos ten√≠amos una inmensa confianza."},{"type":"tweet","author":"SexySpittie","content":"http://t.co/4auGM2gpEd"},{"type":"tweet","author":"KennyVersos","content":"Me ignora por 1 dia que eu te ignoro por 1 m√™s, sou assim n√£o sei brincar."},{"type":"tweet","author":"JemmaBaker8","content":"Omg anybody remember the word 'Bashment' hahahhaaaaa"},{"type":"tweet","author":"SexySpittie","content":"http://t.co/38y0h7uLaW"},{"type":"tweet","author":"hcaz96","content":"I wish i had the type of friend i could go to town with and cry on there shoulder."},{"type":"tweet","author":"stuffingballs","content":"it seems I only ever play Lana Del Rey on my speakers these days."},{"type":"tweet","author":"Patri_NLHLZ_1D","content":"@ElChicoFuckYou Vale, te prometo que no habr√° m√°s tweets as√≠."},{"type":"tweet","author":"MissWinkingP","content":"@Laura_Loui5e why yes.....always x"},{"type":"tweet","author":"SexySpittie","content":"\"@Brazzers: What would you name your Dick?\" Mr T"},{"type":"tweet","author":"ThomasPrice182","content":"@TDP182_Official Sounds stupid but hopefully we get hammered then Rafa gets the sack, so we can be back to the best again :-)"},{"type":"tweet","author":"_s5am","content":"Tem uma pessoas, que juro que tento descobrir de onde achou meu facebook"},{"type":"tweet","author":"GeorginaLouiseW","content":"@dangerousDdave bit gonna lie that means nothing to me lol üôà I just meant  drug land central is prob not the place for a mosque lol"},{"type":"tweet","author":"Indzsyo","content":"She should be grateful I even know her"},{"type":"tweet","author":"april_jo1","content":"Mama best be good!"},{"type":"tweet","author":"SexySpittie","content":"I'm done"},{"type":"tweet","author":"Johnpaullll","content":"@laurenbaxter_ @GazGShore I didn't get to see it he deleted it :( what was it haha?"},{"type":"tweet","author":"tuxedo_marx","content":"@Derginet also impressive: http://t.co/gWDvvbyeNY"},{"type":"tweet","author":"ourqueenrauhl","content":"je meurs ."},{"type":"tweet","author":"_GisselleRamos","content":"Gracias a un experimento, me quem√© mi dedo √≠ndice ‚òπ."},{"type":"tweet","author":"LoveeforPyP1D","content":"Holaaaa! &lt;3"},{"type":"tweet","author":"ThomasPrice182","content":"@TDP182_Official would be the best thing ever, although I don't think it would happen :-/ ;-("},{"type":"tweet","author":"_GisselleRamos","content":"‚úÑ."},{"type":"tweet","author":"ourqueenrauhl","content":"@DieusteenBieber cadre ?"},{"type":"tweet","author":"StephenEngel","content":"@CornwallStadium Thanks for the follow. You have some of the best supporters in #rugby !!!"},{"type":"tweet","author":"ThomasPrice182","content":"@TDP182_Official we can all hope though! üëè"},{"type":"tweet","author":"hollywaltersx","content":"@Rii_XX omg who now?!?!"},{"type":"tweet","author":"tuxedo_marx","content":"@Derginet every photo on this page is great"},{"type":"tweet","author":"hollywaltersx","content":"@KatanaV_ @fayeenorman swarm love the horse banter."},{"type":"tweet","author":"Patri_NLHLZ_1D","content":"me *-*. http://t.co/7INruHWL8l"},{"type":"tweet","author":"ghostly_bob","content":"http://t.co/xzHsGJ59cs"},{"type":"tweet","author":"lucyy_w","content":"@justinbieber #HannahForBirminghamOLLG Block 11. Row KK. Seat 480"},{"type":"tweet","author":"JuliConesa","content":"Por fin desp de tanto time el Golcito parte para el taller..Ma√±ana!"},{"type":"tweet","author":"_s5am","content":"Vir ser meu marido n√£o quer n√© ... Af http://t.co/oAdJR7uxeo"},{"type":"tweet","author":"ourqueenrauhl","content":"@DieusteenBieber de rien :)"},{"type":"tweet","author":"flower_ll","content":"‰∏∫‰ªÄ‰πàÊÄªÊòØÊííÊ≤°ÂøÖË¶ÅÁöÑÊÖåÔºåËá™Ê¨∫Ê¨∫‰∫∫ÁúüÁöÑÂ•Ω‰πàÔºå‰∏çÊáÇÔºå‰πü‰∏çÊÉ≥ÊáÇ"},{"type":"tweet","author":"_LouiseEB","content":"@laurenfarrar94 Screw placement... lets go to the Ocean."},{"type":"tweet","author":"SexySpittie","content":"You guys are lucky. Those pics where on my Droid only."},{"type":"tweet","author":"LuuuOfficial","content":"#FechasInolvidables cuando nacio One Direction &lt;3"},{"type":"tweet","author":"_GisselleRamos","content":"@NiallOfficial niaaaaaaaaaaaaaall ‚ò∫‚ô•"},{"type":"photo","author":"stevenfeven","content":"/img/photos/d971943c811511e28ce622000a9f13a7_7.jpg"},{"type":"photo","author":"flasktest","content":"/img/photos/6e93e21684e211e2b42122000a9d0ed9_7.jpg"},{"type":"photo","author":"flasktest","content":"/img/photos/886be3c884e211e292fc22000a1f9806_7.jpg"},{"type":"photo","author":"flasktest","content":"/img/photos/af1b230884e211e2ad5622000a1f98e5_7.jpg"},{"type":"photo","author":"james__ash","content":"/img/photos/50dce87684e211e28c8422000a1f931c_7.jpg"},{"type":"photo","author":"kristinacolex","content":"/img/photos/f71b869884e211e2a97322000a1fb158_7.jpg"},{"type":"tweet","author":"JackHdixon","content":"I don't know about you, but I'm feelin' twenty two #taylorwritessongsaboutme"},{"type":"tweet","author":"SexySpittie","content":"HAIL BRITANNIA!"},{"type":"tweet","author":"FirdausAzmi","content":"WWE OMG The Top 50 Incidents in WWE History."},{"type":"tweet","author":"Sophiecahill","content":"I find liam gallagher so attractive i really have to admit that"},{"type":"tweet","author":"JOverill","content":"I get to eat birthday cake tonight!!!!!!"},{"type":"tweet","author":"devseo","content":"WordPress SEO Infographic ~ Top 20 √¢¬Ä¬úHow Tos√¢¬Ä¬ù for Your Own Website - http://t.co/PiZaagUoTW"},{"type":"tweet","author":"CharFrederick","content":"@BenoClements phones broken again, you on nights???"},{"type":"tweet","author":"sophie_becks","content":"@chel_wally il be at urs like 6ish"},{"type":"tweet","author":"UncleGoodAdvice","content":"Fat cats should be banned from TV. \nhttp://t.co/rzaa7mos01"},{"type":"tweet","author":"80album","content":"@003Jim Mate, you're just xenophobic mate. I agree I don't give a shit though"},{"type":"tweet","author":"di_ana299","content":"–ü—É—Å–∫–∞–ª–∏ —Å –Æ–ª–µ–π –º—ã–ª—å–Ω—ã–µ –ø—É–∑—ã—Ä–∏. –ò –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ, –∫—Ç–æ –∏–∑ –Ω–∞—Å —Ä–∞–¥ –±—ã–ª —ç—Ç–æ–º—É –±–æ–ª—å—à–µ ))) http://t.co/ap90EfXgZ1"}],

    cork: false,

    pouring: false,

    ledCount: 0,

    updateCount: 0,

    ledIncrement: 2,

    init: function () {

        this.bindMediatorEvents();

        // this.drip();

        return this;

    },

    bindMediatorEvents: function () {

        var self = this;

        mediator.subscribe("content:update", function (data, channel) {

            if (self.cork === false && self.ledCount < 32 && self.pouring === false) {

                self.content.push(data);

                console.log("Content added: ", self.content.length);

                self.updateCount++;

                if (self.updateCount === self.ledIncrement) {

                    self.updateCount = 0;

                    self.ledCount++;

                    console.log("ledCount: ", self.ledCount);

                    mediator.publish("fluid:update", self.ledCount);

                }

                mediator.publish("websocket:broadcast", {

                    topic: channel.namespace,

                    payload: data

                });

            }

        });

        mediator.subscribe("flow:update", function (data, channel) {

            if (self.cork === false) {

                if (data > 0) {

                    self.pouring = true;

                } else {

                    self.pouring = false;

                }

                mediator.publish("websocket:broadcast", {

                    topic: channel.namespace,

                    payload: data

                });

            }

        });

        mediator.subscribe("cork:update", function (data) {

            if (data === "0") {

                self.cork = false;

                self.drip();

            } else {

                self.cork = true;

                clearTimeout(self.dripTimeout);

            }

            console.log("Cork set: ", data);

        });

        mediator.subscribe("content:consumed", function () {

            if (self.cork === false && self.ledCount >= 0) {

                self.content.shift();

                self.updateCount--;

                if (self.updateCount < 0) {

                    self.updateCount = self.ledIncrement - 1;

                    self.ledCount--;

                    console.log("ledCount: ", self.ledCount);

                    mediator.publish("fluid:update", self.ledCount);

                }

            }

        });

        mediator.subscribe("websocket:joined", function () {

            mediator.publish("websocket:broadcast", {

                topic: "content:archive",

                payload: self.content

            });

        });

    },

    drip: function () {

        var self = this,
            duration = this.getRandomNumber(100, 5000),
            timeout,
            contentIndex;

        if (self.dummyContent.length) {

            contentIndex = this.getRandomNumber(0, self.dummyContent.length);

            self.dripTimeout = setTimeout(function () {

                mediator.publish("content:update", self.dummyContent.splice(contentIndex, 1)[0]);

                if (self.dummyContent.length) {

                    self.drip();

                }

            }, duration);

        }

    },

    getRandomNumber: function (min, max) {

        return Math.random() * (max - min) + min;

    }

};

module.exports = flask;